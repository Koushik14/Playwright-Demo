const a56_0x930ff=a56_0x302a;function a56_0x302a(_0x2d7726,_0xd28c57){const _0x3e3b2e=a56_0x3e3b();return a56_0x302a=function(_0x302a0f,_0x5eb561){_0x302a0f=_0x302a0f-0xed;let _0x351e53=_0x3e3b2e[_0x302a0f];return _0x351e53;},a56_0x302a(_0x2d7726,_0xd28c57);}(function(_0x35f859,_0x49ee7d){const _0x1cba9d=a56_0x302a,_0x9e6afb=_0x35f859();while(!![]){try{const _0x31ee0f=parseInt(_0x1cba9d(0x13a))/0x1*(parseInt(_0x1cba9d(0x168))/0x2)+parseInt(_0x1cba9d(0x11d))/0x3+-parseInt(_0x1cba9d(0x102))/0x4*(parseInt(_0x1cba9d(0x13e))/0x5)+parseInt(_0x1cba9d(0xf1))/0x6+parseInt(_0x1cba9d(0xfd))/0x7*(parseInt(_0x1cba9d(0x142))/0x8)+parseInt(_0x1cba9d(0x116))/0x9+parseInt(_0x1cba9d(0x143))/0xa*(-parseInt(_0x1cba9d(0x13c))/0xb);if(_0x31ee0f===_0x49ee7d)break;else _0x9e6afb['push'](_0x9e6afb['shift']());}catch(_0x6b0581){_0x9e6afb['push'](_0x9e6afb['shift']());}}}(a56_0x3e3b,0xe690a));const fs=require('fs'),path=require('path'),os=require('os'),{spawn}=require(a56_0x930ff(0xee)),helper=require('../helper'),logger=require('../logger')[a56_0x930ff(0x157)],{logDir}=require(a56_0x930ff(0xf5)),PercyBinary=require(a56_0x930ff(0x13b));class Percy{#logfile=path[a56_0x930ff(0x12b)](logDir,'percy.log');#address=process['env']['PERCY_SERVER_ADDRESS']||a56_0x930ff(0x15d);#binaryPath=null;#config=null;#proc=null;#isApp=![];['isProcessRunning']=![];constructor(_0x21f08d){const _0x1063d4=a56_0x930ff,_0x5a6a4d={};_0x5a6a4d[_0x1063d4(0x136)]=function(_0x2cc2fb,_0x230163){return _0x2cc2fb!==_0x230163;},_0x5a6a4d[_0x1063d4(0x16b)]='TzKSJ',_0x5a6a4d[_0x1063d4(0x141)]=_0x1063d4(0x12c);const _0x3c607c=_0x5a6a4d;this.#config=_0x21f08d,!!_0x21f08d[_0x1063d4(0x112)]&&(_0x3c607c[_0x1063d4(0x136)](_0x3c607c[_0x1063d4(0x16b)],_0x3c607c[_0x1063d4(0x141)])?this.#isApp=!![]:_0x38f9d9[_0x1063d4(0x14b)]=![]);}async #getBinaryPath(){const _0x38a28d=a56_0x930ff,_0x17acc4={'CgFoM':function(_0x51f092,_0x33f4c9){return _0x51f092(_0x33f4c9);},'LRpsa':function(_0x54636e,_0x356de8){return _0x54636e+_0x356de8;},'vIQju':_0x38a28d(0x15f),'BEnTT':function(_0x1972f3,_0x5bd34e){return _0x1972f3===_0x5bd34e;},'IWMUD':'vlHyx','fXHUw':_0x38a28d(0x137)};if(!this.#binaryPath){if(_0x17acc4[_0x38a28d(0x10f)](_0x17acc4[_0x38a28d(0xfa)],_0x17acc4[_0x38a28d(0x124)])){const _0x1ec3f9={'oDaMa':function(_0x31541f,_0xe6f691){const _0x5e16c3=_0x38a28d;return _0x17acc4[_0x5e16c3(0x16a)](_0x31541f,_0xe6f691);},'AKJae':function(_0x2897e7,_0xee0d99){const _0x3e8c2c=_0x38a28d;return _0x17acc4[_0x3e8c2c(0x16c)](_0x2897e7,_0xee0d99);},'TxcFZ':_0x17acc4[_0x38a28d(0x16d)]};_0x3bdf7e['writeFile'](_0x4ea6fd,_0x2d501e[_0x38a28d(0x100)](_0x1498ad),_0x1edf9b=>{const _0x15a1f8=_0x38a28d;_0x1edf9b&&(_0x6c4b7c['error'](_0x15a1f8(0x110)+_0x1edf9b),_0x1ec3f9['oDaMa'](_0x2670ba,null)),_0x197885['debug'](_0x1ec3f9[_0x15a1f8(0x16f)](_0x1ec3f9[_0x15a1f8(0x14a)],_0xde5262)),_0x1ec3f9[_0x15a1f8(0x155)](_0xf7a0fc,_0x30ea42);});}else{const _0x383209=new PercyBinary();this.#binaryPath=await _0x383209[_0x38a28d(0x125)](this.#config);}}return this.#binaryPath;}async #sleep(_0x27a148){return new Promise(_0x549236=>setTimeout(_0x549236,_0x27a148));}async[a56_0x930ff(0x13d)](){const _0x494c3a=a56_0x930ff,_0x154440={'LzbmY':function(_0x306102,_0x44d0d9){return _0x306102(_0x44d0d9);},'UpkAD':function(_0x3581c3,_0x10348e){return _0x3581c3===_0x10348e;},'uKhUD':_0x494c3a(0x154),'kqSOQ':'GET','DTkbt':_0x494c3a(0x11a),'cZVAg':_0x494c3a(0x12e),'VKDsy':_0x494c3a(0x134),'kWArh':function(_0x27eb18,_0x200de8){return _0x27eb18!==_0x200de8;},'NoUQM':_0x494c3a(0x165)};try{if(_0x154440['UpkAD'](_0x154440[_0x494c3a(0x10e)],_0x154440[_0x494c3a(0x10e)])){const _0x3203a8=await helper[_0x494c3a(0x15b)](_0x154440['kqSOQ'],_0x154440[_0x494c3a(0x101)],null,null,this.#address);if(_0x3203a8){if(_0x154440['UpkAD'](_0x154440['cZVAg'],_0x154440['VKDsy']))this['isProcessRunning']=![],_0x154440['LzbmY'](_0x9e9f,_0x2f859d);else return!![];}}else return new _0x337b72(_0x577cb1=>_0x4c2188(_0x577cb1,_0x45be63));}catch(_0x2c9e8e){if(_0x154440[_0x494c3a(0xf7)](_0x154440['NoUQM'],_0x154440['NoUQM']))_0x4dee50[_0x494c3a(0x169)](_0x494c3a(0x110)+_0x29a6c3),_0x154440['LzbmY'](_0x13f702,null);else return![];}}async['start'](){const _0x6da50a=a56_0x930ff,_0x150c35={'RRbNz':_0x6da50a(0x173),'qQfEp':function(_0x2d2423,_0x10d460){return _0x2d2423!==_0x10d460;},'hlMIs':_0x6da50a(0x14e),'qoYde':_0x6da50a(0xff),'RIpPR':function(_0x49c2fb,_0x175133){return _0x49c2fb(_0x175133);},'xiMIx':function(_0x40133b,_0x2e09fc,_0x3a8943){return _0x40133b(_0x2e09fc,_0x3a8943);},'oVFOE':'exec:stop','ZEHfd':_0x6da50a(0x114),'jrIhd':function(_0x37a689,_0x2bf7bd){return _0x37a689===_0x2bf7bd;},'UdlDV':_0x6da50a(0x151),'HyIrv':'hTJEU','QasfI':'app:exec','dwQok':_0x6da50a(0xf8),'AAUvx':function(_0x49e7c7,_0x5cdba9){return _0x49e7c7!==_0x5cdba9;},'CmEgY':_0x6da50a(0x127),'LLDvK':_0x6da50a(0xef),'OwtTQ':function(_0x3d2e20,_0x3f4206,_0xaec755,_0x253593){return _0x3d2e20(_0x3f4206,_0xaec755,_0x253593);},'AAhsR':_0x6da50a(0x156),'bkAJf':_0x6da50a(0x131),'JnIdN':'RzvUu'},_0xf6438c=await this.#getBinaryPath(),_0x3e807c={};_0x3e807c['flags']='a';const _0x2d3583=fs['createWriteStream'](this.#logfile,_0x3e807c),_0x5bf852=await this[_0x6da50a(0x128)](),_0x295c4d=await this['createPercyConfig']();if(!_0x5bf852){if(_0x150c35[_0x6da50a(0x153)](_0x150c35[_0x6da50a(0x14d)],_0x150c35[_0x6da50a(0x12a)]))_0x9fdfdc['version']='2';else return![];}const _0xe8ca39=[(this.#isApp?_0x150c35[_0x6da50a(0x108)]:_0x150c35[_0x6da50a(0xfe)])+':start'];if(_0x295c4d){if(_0x150c35[_0x6da50a(0x161)](_0x150c35[_0x6da50a(0xf4)],_0x150c35['LLDvK']))_0xe8ca39[_0x6da50a(0x121)]('-c',_0x295c4d);else return _0x36c3e9['debug'](_0x150c35['RRbNz']),!![];}const _0x59cdd2={};_0x59cdd2[_0x6da50a(0x146)]=_0x5bf852,this.#proc=_0x150c35[_0x6da50a(0xf0)](spawn,_0xf6438c,_0xe8ca39,{'env':Object[_0x6da50a(0x160)](process[_0x6da50a(0x104)],_0x59cdd2)}),this.#proc[_0x6da50a(0x12f)][_0x6da50a(0x115)](_0x2d3583),this.#proc[_0x6da50a(0x140)][_0x6da50a(0x115)](_0x2d3583),this[_0x6da50a(0x14b)]=!![];var _0x239814=this;this.#proc['on'](_0x150c35[_0x6da50a(0x111)],function(_0x165cbe){const _0x3ea5c1=_0x6da50a;if(_0x150c35[_0x3ea5c1(0xed)](_0x150c35[_0x3ea5c1(0x149)],_0x150c35[_0x3ea5c1(0x152)]))_0x239814['isProcessRunning']=![];else return _0x2d301f['error'](_0x3ea5c1(0x158)+_0x12ee04),null;});do{if(_0x150c35[_0x6da50a(0x153)](_0x150c35[_0x6da50a(0x123)],_0x150c35[_0x6da50a(0x123)])){const _0x75b0c=await this[_0x6da50a(0x13d)]();if(_0x75b0c){if(_0x150c35[_0x6da50a(0x153)](_0x150c35[_0x6da50a(0xfb)],_0x150c35[_0x6da50a(0x147)])){const _0x5a1d60=_0x150c35[_0x6da50a(0x14c)](_0x184aaa,_0x5b4b09,[_0x150c35['oVFOE']]);_0x5a1d60['on'](_0x150c35[_0x6da50a(0x111)],_0x38e055=>{const _0x470544=_0x6da50a;this[_0x470544(0x14b)]=![],_0x150c35[_0x470544(0x171)](_0x411278,_0x38e055);});}else return logger['debug'](_0x150c35[_0x6da50a(0x119)]),!![];}await this.#sleep(0x3e8);}else return null;}while(this[_0x6da50a(0x14b)]);return![];}async['stop'](){const _0xf8fe44=a56_0x930ff,_0x106462={'BrHxD':function(_0x27c9bf,_0x220607){return _0x27c9bf!==_0x220607;},'GWQYz':_0xf8fe44(0x159),'gaSoH':_0xf8fe44(0x122),'lTmuX':function(_0x23fe3d,_0xc9a385){return _0x23fe3d(_0xc9a385);},'qHEeu':function(_0x456e31,_0x33ce74){return _0x456e31===_0x33ce74;},'lRdWu':_0xf8fe44(0x10d),'PJBYJ':_0xf8fe44(0x107),'hVgax':function(_0x5d76fc,_0x2a26a2,_0x2f2889){return _0x5d76fc(_0x2a26a2,_0x2f2889);},'zcdqT':_0xf8fe44(0x103),'UWwAa':_0xf8fe44(0x114)},_0x23a9cd=await this.#getBinaryPath();return new Promise((_0x524958,_0xe18a6)=>{const _0x3077ab=_0xf8fe44;if(_0x106462[_0x3077ab(0x113)](_0x106462['lRdWu'],_0x106462[_0x3077ab(0x163)]))return!![];else{const _0x1dc0c2=_0x106462[_0x3077ab(0x16e)](spawn,_0x23a9cd,[_0x106462[_0x3077ab(0x135)]]);_0x1dc0c2['on'](_0x106462['UWwAa'],_0x2b6645=>{const _0x4dafc8=_0x3077ab;_0x106462[_0x4dafc8(0x15c)](_0x106462[_0x4dafc8(0x11f)],_0x106462[_0x4dafc8(0x11c)])?(this[_0x4dafc8(0x14b)]=![],_0x106462[_0x4dafc8(0x12d)](_0x524958,_0x2b6645)):_0x5168b6[_0x4dafc8(0x121)]('-c',_0x2645f9);});}});}['isRunning'](){const _0x4746af=a56_0x930ff;return this[_0x4746af(0x14b)];}async['fetchPercyToken'](){const _0x5e7be6=a56_0x930ff,_0x48ee5d={'FWOpv':function(_0x408312,_0x2a13d7){return _0x408312(_0x2a13d7);},'yenLK':function(_0x578784,_0xba900c){return _0x578784+_0xba900c;},'MmLbt':_0x5e7be6(0x15f),'zIJZx':function(_0x1a7ea2,_0x5a2482){return _0x1a7ea2===_0x5a2482;},'SKiLV':_0x5e7be6(0xf9),'PWGfS':_0x5e7be6(0x112),'kjNeP':_0x5e7be6(0x166),'xjIIN':'GET','DczBU':_0x5e7be6(0x164),'UJiqV':function(_0x8e4cc8,_0x44d4f1){return _0x8e4cc8!==_0x44d4f1;},'qIRlZ':_0x5e7be6(0x167),'Jfptu':_0x5e7be6(0x144)},_0x404c7e=this.#config[_0x5e7be6(0x139)];try{if(_0x48ee5d[_0x5e7be6(0x10c)](_0x48ee5d[_0x5e7be6(0xfc)],_0x48ee5d[_0x5e7be6(0xfc)])){const _0x4580fd=this.#isApp?_0x48ee5d[_0x5e7be6(0x120)]:_0x48ee5d[_0x5e7be6(0x10b)],_0x210be8=await helper[_0x5e7be6(0x15b)](_0x48ee5d[_0x5e7be6(0x10a)],'api/app_percy/get_project_token?name='+_0x404c7e+_0x5e7be6(0x138)+_0x4580fd,{},this.#config),_0x2fe661=_0x210be8[_0x5e7be6(0x11e)];return logger[_0x5e7be6(0xf2)](_0x48ee5d[_0x5e7be6(0x145)]),_0x2fe661[_0x5e7be6(0x15e)];}else return this[_0x5e7be6(0x14b)];}catch(_0x56c308){if(_0x48ee5d[_0x5e7be6(0x11b)](_0x48ee5d[_0x5e7be6(0xf3)],_0x48ee5d[_0x5e7be6(0x130)]))return logger[_0x5e7be6(0x169)]('Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20'+_0x56c308),null;else _0x507302&&(_0x669119[_0x5e7be6(0x169)]('Error\x20creating\x20percy\x20config:\x20'+_0x3aaeee),_0x48ee5d[_0x5e7be6(0x118)](_0xc06cd4,null)),_0x3de016[_0x5e7be6(0xf2)](_0x48ee5d[_0x5e7be6(0x105)](_0x48ee5d[_0x5e7be6(0x109)],_0x29ebbf)),_0x48ee5d['FWOpv'](_0x391d31,_0x4b3afd);}}async[a56_0x930ff(0xf6)](){const _0x1cd980=a56_0x930ff,_0x54a309={'xvahC':function(_0x444160,_0x1fba42){return _0x444160(_0x1fba42);},'PDaxy':function(_0x1ab438,_0xd76fbb){return _0x1ab438+_0xd76fbb;},'LlzvU':'Percy\x20config\x20created\x20at\x20','lCkFG':function(_0x310122,_0x361270){return _0x310122!==_0x361270;},'ibQWs':_0x1cd980(0x172),'sfLJN':_0x1cd980(0x13f),'NPhMe':function(_0xf29511,_0x4807cf){return _0xf29511!==_0x4807cf;},'ZmSQe':_0x1cd980(0x106)};if(!this.#config[_0x1cd980(0x148)])return _0x54a309[_0x1cd980(0x15a)](_0x54a309['ibQWs'],_0x54a309[_0x1cd980(0x126)])?![]:null;const _0x4b7949=path[_0x1cd980(0x12b)](os[_0x1cd980(0x133)](),_0x54a309[_0x1cd980(0x14f)]),_0x1c26b1=this.#config[_0x1cd980(0x148)];if(!_0x1c26b1[_0x1cd980(0x132)]){if(_0x54a309[_0x1cd980(0x117)](_0x54a309[_0x1cd980(0x129)],_0x54a309['ZmSQe']))return![];else _0x1c26b1['version']='2';}return new Promise((_0x54510d,_0x47b1cb)=>{const _0xafa50f=_0x1cd980;fs[_0xafa50f(0x170)](_0x4b7949,JSON[_0xafa50f(0x100)](_0x1c26b1),_0x562480=>{const _0x2e073b=_0xafa50f;_0x562480&&(logger[_0x2e073b(0x169)](_0x2e073b(0x110)+_0x562480),_0x54a309['xvahC'](_0x54510d,null)),logger[_0x2e073b(0xf2)](_0x54a309[_0x2e073b(0x162)](_0x54a309['LlzvU'],_0x4b7949)),_0x54a309['xvahC'](_0x54510d,_0x4b7949);});});}}module[a56_0x930ff(0x150)]=Percy;function a56_0x3e3b(){const _0xfbc9be=['assign','AAUvx','PDaxy','PJBYJ','Percy\x20fetch\x20token\x20success','LvuKG','automate','ILOsw','6yjuZbh','error','CgFoM','KVedD','LRpsa','vIQju','hVgax','AKJae','writeFile','RIpPR','fzrdP','Percy\x20healthcheck\x20successful','qQfEp','child_process','FgJPd','OwtTQ','2891370IechUJ','debug','qIRlZ','CmEgY','../logger','createPercyConfig','kWArh','exec','SVULV','IWMUD','bkAJf','SKiLV','28PTlSIG','dwQok','lOWss','stringify','DTkbt','28DIwvGg','exec:stop','env','yenLK','szNGA','iUBfR','QasfI','MmLbt','xjIIN','kjNeP','zIJZx','uQxvg','uKhUD','BEnTT','Error\x20creating\x20percy\x20config:\x20','ZEHfd','app','qHEeu','close','pipe','4974075LzrUdo','NPhMe','FWOpv','RRbNz','percy/healthcheck','UJiqV','gaSoH','4212468dQFTIO','data','GWQYz','PWGfS','push','OnNjO','AAhsR','fXHUw','getBinaryPath','ibQWs','zWPFq','fetchPercyToken','ZmSQe','HyIrv','join','IlnNK','lTmuX','mohyJ','stdout','Jfptu','uJMIi','version','tmpdir','XaKyJ','zcdqT','rUsCU','iyRVL','&type=','projectName','92149KBpIcT','./PercyBinary','1693109kDGSUJ','healthcheck','228460iAnLaB','percy.json','stderr','TmfKd','2331376BELcdB','170sODBZo','ieJwT','DczBU','PERCY_TOKEN','JnIdN','percyOptions','hlMIs','TxcFZ','isProcessRunning','xiMIx','UdlDV','mTOFy','sfLJN','exports','yGGIh','qoYde','jrIhd','OgTRX','oDaMa','euWvI','winstonLogger','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','TQwNF','lCkFG','nodeRequest','BrHxD','http://localhost:5338','token','Percy\x20config\x20created\x20at\x20'];a56_0x3e3b=function(){return _0xfbc9be;};return a56_0x3e3b();}